<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Anki Chan - 智能学习助手</title>
  <link rel="stylesheet" href="main.css">
  <link rel="stylesheet" href="css/settingPanel.css">
</head>

<body>

  <!-- Anki连接状态提示 -->
  <div id="ankiConnectionModal" style="display: none;">
    <div class="modal-overlay"></div>
    <div class="modal-content">
      <h3>无法连接到 Anki</h3>
      <p>请确保 Anki 已启动并安装了 AnkiConnect 插件</p>
      <div class="modal-buttons">
        <button id="btnRetryConnection" class="btn-retry">重试连接</button>
      </div>
    </div>
  </div>

  <div id="topBar">
    <div id="topBarLeft">
      <input type="text" id="searchInput" placeholder="Search (Anki query syntax)">
      <button id="searchButton">Search</button>
    </div>
    <div id="topBarRight">
      <button id="settingsButton">Settings</button>
    </div>
  </div>

  <div id="main">

    <div id="sidebar">
      <button id="sidebarToggle" title="折叠/展开侧边栏">☰</button>
      <div id="sidebarTabs">
        <button id="tabDecks" class="active">Decks</button>
        <button id="tabQueue">Study Queue</button>
      </div>

      <div id="sidebarDecks">
        <ul id="deckTree"></ul>
      </div>

      <div id="sidebarQueue">
        <div id="queueList"></div>
        <div id="queueSummary" style="margin-top: var(--spacing-lg); padding: var(--spacing-lg); background: linear-gradient(135deg, var(--color-primary-light) 0%, var(--color-bg-secondary) 100%); border-radius: var(--radius-md); box-shadow: var(--shadow-sm);">
          <span style="font-weight: 600; color: var(--color-primary);">Total: 0 cards</span>
        </div>
        <div style="margin-top: var(--spacing-lg); padding: var(--spacing-lg); background: var(--color-bg-primary); border: 1px solid var(--color-border); border-radius: var(--radius-md); box-shadow: var(--shadow-sm);">
          <label style="font-size: var(--font-size-sm); font-weight: 600; display: block; margin-bottom: var(--spacing-sm); color: var(--color-text-secondary);">学习模式：</label>
          <select id="queueMode" style="width: 100%; padding: var(--spacing-sm); font-size: var(--font-size-sm); border: 1px solid var(--color-border); border-radius: var(--radius-md); background-color: var(--color-bg-secondary);">
            <option value="auto">自动移出（已完成）</option>
            <option value="once">学习一次即移出</option>
            <option value="keep">保留反复学习</option>
          </select>
        </div>
      </div>
    </div>

    <div id="mainView">
      <!-- 展开侧边栏按钮 -->
      <button id="sidebarExpandBtn" title="展开侧边栏">☰</button>

      <div id="viewCardList">
        <h2>卡片列表</h2>
        <div class="btn-group">
          <button id="btnAddSelectedToQueue">添加到学习队列</button>
        </div>
        <div style="margin: var(--spacing-lg) 0; padding: var(--spacing-lg); background: var(--color-bg-secondary); border-radius: var(--radius-md); border: 1px solid var(--color-border);">
          <label style="font-weight: 600; color: var(--color-text-secondary); font-size: var(--font-size-sm);">筛选条件：</label>
          <select id="filterCategory" style="margin: 0 var(--spacing-md); padding: var(--spacing-sm) var(--spacing-md); border: 1px solid var(--color-border); border-radius: var(--radius-md); font-size: var(--font-size-sm); background-color: var(--color-bg-primary);">
            <option value="">无筛选</option>
            <option value="today">今天</option>
            <option value="flag">旗标</option>
            <option value="state">卡片状态</option>
            <option value="note">笔记模板</option>
            <option value="tag">标签</option>
          </select>
          <select id="filterSubCategory" style="display: none; padding: var(--spacing-sm) var(--spacing-md); border: 1px solid var(--color-border); border-radius: var(--radius-md); font-size: var(--font-size-sm); background-color: var(--color-bg-primary);">
            <option value="">请选择</option>
          </select>
          <button id="btnApplyFilter">应用筛选</button>
        </div>
        <table id="cardTable">
          <thead>
            <tr>
              <th style="width: 60px;">选择</th>
              <th>正面</th>
              <th>状态</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>

      <div id="viewStudy">
        <!-- 学习进度 - 右上角 -->
        <div class="study-progress-card">
          <span>进度</span>
          <span id="studyProgress" style="font-weight: 600; color: var(--color-primary); font-size: var(--font-size-base);">0/0</span>
        </div>

        <!-- 卡片正面 -->
        <div>
          <div id="studyFront"></div>
        </div>

        <!-- AI 问题 -->
        <div>
          <div id="studyQuestion"></div>
        </div>

        <!-- 用户答案 -->
        <div>
          <textarea id="studyAnswer" rows="5" placeholder="在此输入你的答案..."></textarea>
        </div>

        <!-- 操作按钮 -->
        <div class="action-buttons">
          <button id="btnShowAnswer">显示答案</button>
          <button id="btnGetFeedback">获取 AI 反馈</button>
        </div>

        <!-- 卡片背面 -->
        <div>
          <div id="studyBack"></div>
        </div>

        <!-- AI 反馈 -->
        <div>
          <div id="studyFeedback"></div>
        </div>

        <!-- 评分区域 -->
        <div class="rating-section">
          <div class="rating-buttons">
            <button id="btnAgain" class="rating-btn" data-ease="1">
              <span>😰</span>
              <span>重来</span>
            </button>
            <button id="btnHard" class="rating-btn" data-ease="2">
              <span>😅</span>
              <span>困难</span>
            </button>
            <button id="btnGood" class="rating-btn" data-ease="3">
              <span>😊</span>
              <span>良好</span>
            </button>
            <button id="btnEasy" class="rating-btn" data-ease="4">
              <span>😎</span>
              <span>简单</span>
            </button>
          </div>
        </div>
      </div>

      <div id="viewSettings">
        <h2>AI 设置</h2>

        <h3>模型配置</h3>
        <button id="addModelBtn" type="button">添加模型</button>
        <div class="settings-table-wrapper">
        <table id="modelsTable">
          <thead>
            <tr>
              <th>标识</th>
              <th>显示名称</th>
              <th>API Key 环境变量</th>
              <th>Base URL</th>
              <th>模型名称</th>
              <th>Temperature</th>
              <th>删除</th>
            </tr>
          </thead>
          <tbody>
            <!-- JS 渲染 -->
          </tbody>
        </table>
        </div>
        <h3>角色配置</h3>
        <button id="addRoleBtn" type="button">添加角色</button>
        <div class="settings-table-wrapper">
        <table id="rolesTable">
          <thead>
            <tr>
              <th>标识</th>
              <th>显示名称</th>
              <th>模型</th>
              <th>系统提示词</th>
              <th>用户提示词</th>
              <th>删除</th>
            </tr>
          </thead>
          <tbody>
            <!-- JS 渲染 -->
          </tbody>
        </table>
        </div>
        <button id="saveSettingsBtn" type="button">保存设置</button>


      </div>

    </div>
    <script src="js/settingManage.js"></script>
    <script src="main.js"></script>

</body>

</html>